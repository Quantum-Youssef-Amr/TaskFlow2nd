<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Users - TaskFlow</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="assets/css/style.css">
</head>

<body>
    <div class="container mt-5 pt-4">
        <h1 class="mb-4">Team Members</h1>

        <!-- Access Denied for non-managers -->
        <div id="accessDenied" class="text-center py-5" style="display:none;">
            <h3 class="text-danger">Access Denied</h3>
            <p>Only managers can view team members.</p>
            <a href="dashboard.html" class="btn btn-accent">Back to Dashboard</a>
        </div>

        <!-- Main Content -->
        <div id="usersContent">
            <div class="card shadow">
                <div class="card-body">
                    <h5>All Team Members</h5>
                    <div class="table-responsive">
                        <table class="table table-dark table-hover">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Email</th>
                                    <th>Role</th>
                                    <th>Team ID</th>
                                    <th>Team Name</th>
                                </tr>
                            </thead>
                            <tbody id="usersTable">
                                <!-- Filled by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="assets/js/main.js"></script>
    <script>
        // Check if manager
        if (localStorage.getItem('role') !== 'manager') {
            document.getElementById('usersContent').style.display = 'none';
            document.getElementById('accessDenied').style.display = 'block';
        } else {
            // Get data from login response
            const teamId = localStorage.getItem('teamId');
            const teamName = localStorage.getItem('teamName') || 'My Team';
            const users = JSON.parse(localStorage.getItem('teamUsers') || '[]');

            // Render table
            const tbody = document.getElementById('usersTable');
            if (users.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" class="text-center text-muted">No team members yet</td></tr>';
            } else {
                tbody.innerHTML = users.map(u => `
          <tr>
            <td><strong>${u.name}</strong></td>
            <td>${u.email}</td>
            <td>
              <span class="badge ${u.role === 'manager' ? 'bg-danger' : 'bg-secondary'}">
                ${u.role.toUpperCase()}
              </span>
            </td>
            <td><strong class="text-accent">#${teamId}</strong></td>
            <td>${teamName}</td>
          </tr>
        `).join('');
            }

            // Optional: Show team info at top
            document.querySelector('h1').insertAdjacentHTML('afterend',
                `<div class="alert alert-info mb-4">
          <strong>Team ID:</strong> <span class="text-accent">#${teamId}</span> | 
          <strong>Team Name:</strong> ${teamName}
        </div>`
            );
        }
    </script>
</body>

</html>