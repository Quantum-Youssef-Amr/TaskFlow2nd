<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - TaskFlow</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="assets/css/style.css">
</head>

<body>
    <div class="container mt-5 pt-4">
        <h1 class="mb-4">Hello, <span class="text-accent" id="userName">User</span>!</h1>

        <div class="row g-4 mb-5">
            <div class="col-md-3">
                <div class="card text-center p-4 shadow">
                    <h2 id="totalTasks">0</h2>
                    <p>Total Tasks</p>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card text-center p-4 shadow bg-success">
                    <h2 id="completedTasks">0</h2>
                    <p>Completed</p>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card text-center p-4 shadow bg-warning text-dark">
                    <h2 id="inProgressTasks">0</h2>
                    <p>In Progress</p>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card text-center p-4 shadow bg-danger">
                    <h2 id="overdueTasks">0</h2>
                    <p>Overdue</p>
                </div>
            </div>
        </div>

        <div class="card shadow">
            <div class="card-body">
                <h5>Task Completion Trend</h5>
                <canvas id="trendChart" height="100"></canvas>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="assets/js/main.js"></script>
    <script>
        // NOW IT WORKS â€” Access global data from main.js
        window.addEventListener('load', () => {
            const tasks = window.tasks || JSON.parse(localStorage.getItem('tasks') || '[]');

            const total = tasks.length;
            const completed = tasks.filter(t => t.status === 'done').length;
            const inProgress = tasks.filter(t => t.status === 'in-progress').length;
            const overdue = tasks.filter(t => new Date(t.due) < new Date() && t.status !== 'done').length;

            document.getElementById('totalTasks').textContent = total;
            document.getElementById('completedTasks').textContent = completed;
            document.getElementById('inProgressTasks').textContent = inProgress;
            document.getElementById('overdueTasks').textContent = overdue;

            document.getElementById('userName').textContent = localStorage.getItem('user') || 'User';

            new Chart(document.getElementById('trendChart'), {
                type: 'line',
                data: {
                    labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                    datasets: [{
                        label: 'Completed Tasks',
                        data: [completed - 5, completed - 3, completed - 2, completed - 1, completed, completed + 1, completed + 2].map(n => Math.max(0, n)),
                        borderColor: '#FF0B55',
                        backgroundColor: 'rgba(255,11,85,0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: { responsive: true }
            });
        });
    </script>
</body>

</html>